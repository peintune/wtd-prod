J.add("ui"),String.prototype.trim=function(){return this.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},function(J,e){function n(n,r){function T(e){c.placeholder=e}function N(){return Math.floor(Math.random()*16777216).toString(16)}function C(){function t(){J.g("body").first().insertBefore(v)}var e;v=J.create("div",{style:"position:absolute;z-index:10100"}).html('<div class="'+c.tpl+'" id="'+h+'" style="display:none; width:'+c.width+'px"></div>'),c.boxTarget?J.isFunction(c.boxTarget)&&(e=c.boxTarget())?e.append(v):(e=J.g(c.boxTarget))?e.append(v):t():t(),m=J.g(h)}function k(){var e=s.offset();v.setStyle({top:e.y+n.height()+c.offset.y+"px",left:e.x+c.offset.x+"px"})}function L(){J.on(n,J.ua.opera?"keypress":"keydown",A),J.on(n,"keyup",O),J.on(n,"blur",M),J.on(n,"focus",_),J.on(n,"click",function(e){e&&e.stop()}),J.on(window,"resize",k)}function A(e){if(i)return;c.onKeyPress&&c.onKeyPress(n);switch(e.keyCode){case 27:n.val(a.trim()),Y();break;case 9:case 13:if(u===-1){Y();return}W(null,u);break;case 38:V();break;case 40:$();break;default:y=!1;return}e.preventDefault()}function O(e){if(i)return;c.onKeyUp&&c.onKeyUp(n);switch(e.keyCode){case 38:case 40:case 13:case 27:return}if(y)return;clearTimeout(g),g=setTimeout(P,c.defer)}function M(t){clearTimeout(g),c.onBlur&&c.onBlur(t),J.on(e,"click",function(){w=!1,c.forceClear&&(o==-1?(n.val(""),c.onForceClear&&c.onForceClear(n)):Q(o)),Y(),J.un(e,"click",arguments.callee)}),c.placeholder&&n.val().trim()===""&&(c.toggleClass&&n.removeClass(c.toggleClass),n.val(c.placeholder)),a=n.val()}function _(){w=!0;if(i)return;c.onFocus&&c.onFocus(n),c.placeholder==n.val().trim()&&(n.val(""),c.toggleClass&&n.addClass(c.toggleClass)),P();return}function P(){if(i||y){y=!1;return}a=n.val().trim(),u=-1,K(u),B()}function H(){return encodeURIComponent(a.trim())}function B(){E=c.params[c.query]=a.trim();var e;if(c.source){J.isFunction(c.source)?c.source(c.params,R,j):R(c.source);return}if(c.cache&&(e=f[H()]))return R(e,"c");J.get({url:c.url,type:"json",data:c.params,onSuccess:R})}function j(e,t){var n=x.length,r;n&&(x[n-1]=function(){});var i={type:c.type,data:e,url:c.url};if(c.cache){var s="";for(var o in e)s+=e[o];if(f[s]){t(f[s]);return}}c.type==="json"&&(i.onSuccess=x[n]=function(){return function(e){f[s]=e,t(e)}}()),c.type==="jsonp"&&(x[n]=function(){return function(e){f[s]=e,t(e)}}(),i.callback="AutocompleteCallback["+n+"]"),J.get(i)}function F(){}function I(e){var t=[];return J.isString(e)?t:(J.each(e,function(e,n){t.push(q(e,n))}),t)}function q(e,t){var n={};return J.isString(t)?{k:e,v:t,l:t}:(n=c.dataMap?c.dataMap(t):t,n.v||(n.v=U(t)),n.k||(n.k=n.v),n.l||(n.l=n.v),n)}function R(e,t){var r,i,s,a=n.val();o=-1,t?l=e:(e=c.dataKey&&e[c.dataKey]||e.data||e,l=I(e)),c.onResult&&c.onResult(n,l);if(!l||l.length===0){Y();return}t||(f[H()]=l),m.s("div").each(function(e,t){t.un()}),m.empty(),J.each(l,function(e,n){var s=c.itemBuild(n),f=!!s.isSkip;t||c.itemBuild&&J.mix(n,s||{}),i=c.filterHtml?X(n.v):n.v,i==a&&(o=e),f?(S++,n.l&&(r=J.create("p",{"class":"ui_item"}).html(n.l).appendTo(m).on("click",function(e){e&&e.stop()})),delete l[e]):(e-=S,n.l&&(r=J.create("div",{"class":u===e?"ui_item ui_sel":"ui_item",title:i}).html(n.l).appendTo(m)).on("mouseover",z,e).on("click",function(e,t){if(c.onItemClick&&c.onItemClick(t,n,r)===!1)return;W(e,t)},e,!0,!0))}),S=0,J.each(l,function(e,t){!t&&l.splice(e,1)}),G(),d=m.s("div")}function U(e){var t;return J.each(e,function(e,n){return t=n,!1}),t}function z(e,t){d.each(function(e,t){t.removeClass("ui_sel")}),this.className="ui_item ui_sel"}function W(e,t){e&&e.stop(),o=t;var r,i;y=!0,J.isUndefined(t)||(i=l[t],J.mix(i,Q(t)||{}),n.val(a=c.filterHtml?X(i.v):i.v)),Y(),c.autoSubmit&&(r=n.up("form"))&&(c.placeholder==n.val().trim()&&n.val(""),r&&r.get().submit())}function X(e){return e?e.trim().replace(/<\/?[^>]*>/g,""):""}function V(){if(!p)return;if(u<=0){d.eq(u).removeClass("ui_sel"),u=d.length,n.val(E);return}var e;y=!0,d.each(function(e,t){if(t.hasClass("ui_sel"))return t.removeClass("ui_sel"),!1}),n.val(a=X((e=d.eq(--u).addClass("ui_sel")).html())),K(u)}function $(){if(!p)return;if(u===d.length-1){d.eq(u).removeClass("ui_sel"),u=-1,n.val(E);return}var e;y=!0,d.each(function(e,t){if(t.hasClass("ui_sel"))return t.removeClass("ui_sel"),!1}),n.val(a=X((e=d.eq(++u).addClass("ui_sel")).html())),K(u)}function K(e){c.onChange&&e!=-1&&c.onChange(l[e])}function Q(e){return c.onSelect&&e!=-1&&c.onSelect(l[e])}function G(){u=-1,p||(m.show(),p=!0),k()}function Y(){u=-1,y=!1,p&&(m.empty().hide(),p=!1)}function Z(){i=!1}function et(){i=!0}function tt(e,t){c.params=t?e:J.mix(c.params,e,!0)}var i=!1,n=J.g(n),s,o=-1,u=-1,a=n.val().trim(),f=[],l=[],c,h,p=!1,d,v,m,g=null,y=!1,b=null,w=!1,E="",S=0,x=[];return function(){n.attr("autocomplete","off"),c=J.mix(t,r||{},!0),h="Autocomplete_"+N(),s=c.offsetTarget?J.isFunction(c.offsetTarget)?c.offsetTarget():J.g(c.offsetTarget):n,c.width||(c.width=s.width()-2),c.query=c.query||n.attr("name")||"q",a===""&&c.placeholder&&(n.val(c.placeholder),c.toggleClass&&n.removeClass(c.toggleClass)),c.type==="jsonp"&&(window.AutocompleteCallback=x),C(),L()}(),{setParams:tt,setPlaceholder:T,enable:Z,disable:et,hide:Y,show:G}}var t={url:"/",type:"json",dataKey:"",filterHtml:!0,autoSubmit:!0,forceClear:!1,defer:100,width:0,params:{},source:null,offset:{x:0,y:-1},offsetTarget:null,boxTarget:null,query:"",placeholder:"",toggleClass:"",cache:!0,onForceClear:null,onItemClick:null,onResult:null,onChange:null,onSelect:null,onFoucs:null,onKeyPress:null,onBlur:null,onKeyUp:null,dataMap:null,itemBuild:null,tpl:"autocomplete_def"};J.dom.fn.autocompleteV2=function(e){return new n(this.get(),e)},J.ui.autocompleteV2=n}(J,document)